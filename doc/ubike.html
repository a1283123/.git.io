<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
    integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <link rel="stylesheet" href="ubike.css">
</head>

<body>


  <select id="region" name="YourLocation">
    <option value="" default>台北市全區</option>
    <option value="北投區">北投區</option>
    <option value="士林區">士林區</option>
    <option value="中山區">中山區</option>
    <option value="內湖區">內湖區</option>
    <option value="大同區">大同區</option>
    <option value="松山區">松山區</option>
    <option value="萬華區">萬華區</option>
    <option value="中正區">中正區</option>
    <option value="大安區">大安區</option>
    <option value="信義區">信義區</option>
    <option value="南港區">南港區</option>
    <option value="文山區">文山區</option>
  </select>

  <input type="text" id="number">
  <button class="btn btn-primary" onclick="SearchClick()">查詢</button>
  <h3 class="card-title">Ubike 站點資訊</h3>
  <div id="searchResultBlock" class="col-4"></div>
  </div>



</body>
<script>
  //抓到json資料
  var url = 'https://tcgbusfs.blob.core.windows.net/blobyoubike/YouBikeTP.json';
  var data
  fetch(url)
    .then(res => res.json())
    .catch(error => console.error('Error:', error))
    .then(response => {
      data = response.retVal
    });

  //按下搜尋 
  const SearchClick = () => {
    $('#searchResultBlock').empty()
    console.log(data)
    let snonumber = document.querySelector('#number').value;
    const fonunddata = data[snonumber]
    let region = document.querySelector('#region').value
    const regionData = data[k]
    var k
    for (k in data) {
      if (region !== "" && snonumber !== "") {
        let sarea = data[k].sarea.search(snonumber)
        let sna = data[k].sna.search(snonumber)
        let ar = data[k].ar.search(snonumber)
        const regionData = data[k]
        let region = document.querySelector('#region').value
        if (data[k].sarea === region) {
          if (ar !== -1 || sna !== -1) {
            console.log("one")
            let stationBlock = `                         
                          <div class="stationBlock" style="width: 18rem">
                          <div class="stationtext">
                            <h5>站名:<b>${data[k].sna}</b></h5>
                            <p class="card-text">可借車輛:<b>${data[k].sbi}</b></p>
                            <p class="card-text">可還車輛:<b>${data[k].bemp}</b></p>
                            <p class="card-text">車站位址:${data[k].sarea} ${data[k].ar}</p>
                          </div>`
            $('#searchResultBlock').append(stationBlock)
          }
        }
      } else if (snonumber !== "") {
        console.log("two")
        let sarea = data[k].sarea.search(snonumber)
        let sna = data[k].sna.search(snonumber)
        let ar = data[k].ar.search(snonumber)
        if (sarea !== -1 || ar !== -1 || sna !== -1) {

          let stationBlock = `                         
                          <div class="stationBlock" style="width: 18rem">
                          <div class="stationtext">
                            <h5>站名:<b>${data[k].sna}</b></h5>
                            <p class="card-text">可借車輛:<b>${data[k].sbi}</b></p>
                            <p class="card-text">可還車輛:<b>${data[k].bemp}</b></p>
                            <p class="card-text">車站位址:${data[k].sarea} ${data[k].ar}</p>
                          </div>`
          $('#searchResultBlock').append(stationBlock)
        }
      }
      else if (region !== "") {
        let region = document.querySelector('#region').value
        const regionData = data[k]
        if (data[k].sarea === region) {

          console.log("three")
          let stationBlock = `                         
                          <div class="stationBlock" style="width: 18rem">
                          <div class="stationtext">
                            <h5>站名:<b>${data[k].sna}</b></h5>
                            <p class="card-text">可借車輛:<b>${data[k].sbi}</b></p>
                            <p class="card-text">可還車輛:<b>${data[k].bemp}</b></p>
                            <p class="card-text">車站位址:${data[k].sarea} ${data[k].ar}</p>
                          </div>`
          $('#searchResultBlock').append(stationBlock)
        }
      }

    }



  }
  // let region =document.querySelector('#region').value






</script>

</html>